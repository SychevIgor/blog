2 недели назад Microsoft анонсировал Azure Search Api Preview.

<h5><b>Что такое Search Api Preview-?</b> </h5>
Это сервис, предоставляющий возможность хранить, индексировать структурированные данные и производить поиск по ним получая ответ от сервера в виде json/odata через https.

<h5><b>Зачем?</b> </h5>
<ul>
	<li>Фактически, они хотят снизить порог вхождения в поисковые технологии. </li>
	<li>Мы не занимаемся развертыванием Lucene, Sphinx или других поисковых движков, а получаем уже готовый движок из коробки, с которым можно работать. (Когда-то мы делали проект для Imagine Cup где использовали полнотекстовый поиск от Lucene, но развернуть его смогли не с первой попытки). </li>
	<li>Мы можем не сильно ломать себе голову о том, как масштабировать наше поисковое решение. Microsoft уже предоставляет возможность иметь несколько реплик данных и партиций. </li>
	<li>Мы не сильно заморачиваемся поддержанием инфраструктуры, просто потому что это облако.</li>
</ul>
<habracut/>

<h5><b>Алгоритм действий</b> </h5>
Поскольку это preview, то необходимо сначала подключить себе в Azure эту фичу.
Как только она подключена, используем такой простой алгоритм:
<ol>
	<li>Создаем индекс.</li>
	<li>Загружаем документы.</li>
	<li>Ищем по ранее загруженным документам.</li>
</ol>

Само APi не большое
<img src="http://habrastorage.org/files/e45/7e7/540/e457e754017b4a578e9dbcd194bcd7a5.png"/>

<h5><b>Масштабирование и отказоустойчивость</b></h5>
Отказоустойчивость обеспечивается, используя реплики, а масштабируемость — используя партиции.
Всего может быть не более 36 юнитов, поэтому произведение партиций на реплики не может превышать это число 36. Таблица умножения для этого:
<img src="http://habrastorage.org/files/c1e/abe/ede/c1eabeedef7a42b0b41b16226c76a80f.png"/>

<h5><b>Цены и ограничения</b></h5>
Надо понимать, что собрать google/bing/yandex используя search api не получится. Это решение более локальное. Чтобы понять детально ограничения стоит прочесть <a href="http://msdn.microsoft.com/en-us/library/azure/dn798934.aspx">статью </a>. Если кратко, то есть ограничение на количество юнитов, на входной поток, на общий объем документов.

<h5><b>Сейчас действуют 2 тарифа.</b> </h5>
<ul>
	<li>Shred (Free) - это одна нода, до 10000 документов, не более 3 индексов, и 50мб размер хранилища. Для начала поиграться хватит.</li>
	<li>Dedicated – тут вы уже платите. Ограничений на индексы и документы очень мало. Для кого-то будут ограничениями 25 гигов и до 15млн документов на партицию. Ограничение по масштабируемости сейчас до 36 юнитов. Юнит — это единица оплаты. <a href="http://azure.microsoft.com/en-us/pricing/details/search/">Цены </a>сейчас порядка 125$ в месяц указаны  за юнит и это со скидкой в 50%. Т.к. для поиска зарезервированы мощности, то они и стоят хорошо, но и вы можете быть уверены в производительности. Как эти 36 юнитов разбить на партиции и реплики остается на ваше усмотрение, но стоит помнить о том, что более 36 юнитов использовать не получится.</li>
</ul>

<h5><b>Работа с сервисом</b></h5>
Доступ к этому сервису есть только из новой версии портала.
Через него мы можем посмотреть статистику, заказать новые юниты.
<img src="http://habrastorage.org/files/0de/f92/e10/0def92e100124c45b530276f8d497a29.png"/>

Пошаговая <a href="http://azure.microsoft.com/en-us/documentation/articles/search-configure">инструкция </a>как настроить сервис через портал и как сделать первые запросы к нему через fiddler на создание индекса, загрузки документов и поиска по документам. Тут же как менять разные тарифные планы, как на портале посмотреть число документов.

<h5><b>SDK</b></h5>
SDK сейчас не существует, хотя сами разработчики где-то на форуме сказали, что работают над ней. На мой взгляд это существенный косяк, т.к. это повышает уровень вхождения и главное — люди сейчас понапишут своих костылей, а потом будут возмущенные возгласы, что сырая технология еще многие годы. 
На <a href="http://msdn.microsoft.com/library/azure/dn798935.aspx">страничке  </a>можно прочитать полное описание Api. В принципе типичный rest.
Api делится на несколько частей:
<ul>
	<li>Работа с индексом</li>
	<li>Работа с документами</li>
	<li>Поиск документов</li>
	<li>Рекомендации (автодополнения)</li>
</ul>

<h5><b>Тестовый пример</b></h5>
Хоть как-то компенсирует отсутствие SDK наличие <a href="http://azure.microsoft.com/en-us/documentation/articles/search-create-first-solution/">тестового примера</a> . Это веб приложение Adventure Work, которое позволяет искать по индексу и маленькое приложение-инициализитор индекса и документов. Очень рекомендую посмотреть, как реализована работа, перед тем как начнете писать свой код.

В этом приложении поиск используется в 2 эпостасиях:
 
<ul>
	<li>в виде автокомплита, для которого используется suggestion 
<img src="http://habrastorage.org/files/27a/c07/4aa/27ac074aa15e49ffa64e7a5c3e0561ca.png"/></li>
	<li>и непосредственно поиска.
<img src="http://habrastorage.org/files/4ff/248/9dc/4ff2489dc0ad43cba3ce1cd24b1a4efc.png"/></li>
</ul>

<h5><b>Загрузка документов</b></h5>
Мы должны понимать, что загружать мы можем не любой произвольный plain текст, а некоторый json. Сами поля в нем мы контролируем.
Вот пример типичного документа:
<img src="http://habrastorage.org/files/656/f95/41e/656f9541e6ba4e71bbfe526cca9cadf1.png"/> 


<h5><b>Запросы на поисков</b></h5>
Лучше всего прочесть про синтаксис составления запросов из первоисточника.
В любом случае, придется комбинировать непосредственно поиск http://msdn.microsoft.com/en-us/library/azure/dn798921.aspx и фильтрацию от odata http://msdn.microsoft.com/en-us/library/azure/dn798920.aspx 

Api поддерживает операции сортировки выдачи, по страничного вывода, выбор scoring profile и так далее.

<h5><b>Индексы</b></h5>
Мы можем сами создавать индексы, указывая какие поля, какого типа мы хотим добавить, какие поля игнорировать в индексе. 
Вот такой пример запроса на создание индекса.
<img src="http://habrastorage.org/files/ac7/760/625/ac7760625849475bae7822df911ee457.png"/>

<h5><b>Оценка/Scoring</b> </h5>
В Search Api не так много механизмов кастомизации поиска, но они есть.
Один из них — это добавление к индексу алгоритма оценки/scoring. http://msdn.microsoft.com/en-us/library/dn798928.aspx 
Через него вы можете влиять на то какой результат будет считаться приоритетнее- боле новый или более старый, как георгафическая удаленность влияет на результат поиска(для этого в запрос придется отправить георгафические координаты, а так же сами данные должны содержать местоположение.).

<h5><b>Ссылки</b></h5>
<ul>
<li><a href="http://channel9.msdn.com/Shows/Data-Exposed/Introduction-To-Azure-Search">Обсуждением на channel 9 </a></li>
	<li><a href="http://azure.microsoft.com/en-us/services/search/">Стартовая</a></li>
	<li><a href="http://msdn.microsoft.com/library/azure/dn798933.aspx">Общее техническое описание</a></li>
	<li><a href="http://msdn.microsoft.com/en-us/library/azure/dn798934.aspx">Ограничения</a></li>
	<li><a href="http://azure.microsoft.com/en-us/pricing/details/search/">Цены</a></li>
	<li><a href="http://social.msdn.microsoft.com/Forums/windowsazure/en-US/home?forum=azuresearch">Forum  </a>он конечно не сказать что сильно активно используется, но по крайней мере есть.</li>
	<li><a href="http://azure.microsoft.com/en-us/documentation/articles/search-configure/">По шаговая инструкция как настроить сервис через портал и как сделать первые запросы к нему через fiddler</a> </li>
	<li><a href="http://azure.microsoft.com/en-us/documentation/articles/search-create-first-solution/ ">Пример работы с api </a></li>
	<li><a href="http://aws.amazon.com/cloudsearch/">Cloud Search - аналог от AWS</a> </li>
</ul>

Если Вы хотите помочь улучшить статью- предлогайте ваши правки через <a href="https://github.com/SychevIgor/blog/tree/master/Azure/Data%26Storage/SearchApi">github</a>