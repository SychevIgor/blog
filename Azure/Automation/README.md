3 апреля был анонсирован Announcing <a href="http://blogs.technet.com/b/server-cloud/archive/2014/04/03/announcing-microsoft-azure-automation-preview.aspx">Microsoft Azure Automation Preview</a> и до сих пор находится в стадии preview.

<b>Какие задачи призван решать Automation?</b>
<ul>
	<li>Автоматизация рутинных процессов по администрированию azure (то, что делается через портал - создание виртуалок, создание новых очередей, баз данных, выдача прав и т. п.);</li>
	<li>Сделать эти процессы повторяемыми, убрать ручную работу с администратора</li>
</ul>

<h5>Бонус к автоматизации ( kill feature):</h5>
<b>Runbook</b> (powershell скрипт), который использует Automation, выполняется не на вашей машине, а значит, может работать бесконечно, пока его не остановят. Например, он может в бесконечном цикле проверять состояние машин и как только обнаружит недоступность, посылать email дежурному оператору.

<h5>Как раньше решались рутинные задачи по администрированию/автоматизации?</h5>
Либо сидел администратор и в интерфейсе всё это прокликивал ручками;
Либо писались C# программы/скрипты на powershell, использующие windows azure API.

Microsoft решили, что пора наколеночные решения по автоматизации заменить на более профессиональные/серьезные. Дать наконец-то возможность “прикрутить свою кнопку к сайту”.

Естественно, для маленьких проектов всё это не нужно, а нужно когда вам регулярно надо создавать новые стандартные вещи.
<habracut text="Однако знать для общего развития стоит" />
<h4>У интересующихся Azure людей возникнет вопросы:</h4>
<ol>
<li>
<b>Чем отличится Automation от Windows Azure powershell модуля?</b>
Тем, что Azure powershell вы вызываете с вашей локальной машине, скрипт исполняется на вашей машине, а вызывает скрипт внешнее для вас api Azure. Automation Runbook запускается и хранится в самом Azure. 
</li>
<li>Ч<b>ем отличается  Automation от <a href="http://msdn.microsoft.com/en-us/library/azure/dn643632.aspx">WebJob</a> по расписанию на powershell?</b>  
Нас не должно смущать то, что в обоих случаях мы можем писать на powershell и запускать их через вебсайт, разница в целях для которых они используются. 
WebJob созданы для поддержки развернутого приложения.  Automation создан для автоматизации рутинных действий по администрированию. Т.е. WebJob пришел от разработчиков и сопровождение, а automation от админов.
</li>
<li><b>Чем отличается Automation от <a href="http://msdn.microsoft.com/en-us/library/azure/dd179380.aspx">Microsoft Azure Management Libraries</a>  и/или Azure SDK  ? (Этот вопрос возник у меня, тк в описании MAML тоже было много слов про автоматизацию и deploy)</b>
Использование <a href="http://www.nuget.org/packages/microsoft.windowsazure.management.libraries">MAML</a> – это написание на C# кода, это часть выпущенного AzureSDK.  Automation- это код на powershell, в котором описан Workflow процесс. Т.е. часть функционала пересекается, но в Automation важна именно возможность создавать долгоживущие процессы. Опять же, Automation- для IT, а не для разработчиков.</li>
</ol>

<h4>Давайте посмотрим на примерах:</h4>
<h5>Примеры для MAML:</h5>
<ul>
	<li>В видео с конференции build показывают, как использовать эту фичу для создание пререквизитов для тестов, чтобы каждый раз все было чистенькое. </li>
	<li>Допустим у вас есть в azure несколько контуров - (набора виртуалок, сервисов, баз данных и тд). На одном вы разрабатываете, на другом теститесь, на третьем готовите релиз, на четвертом продакшен. Если писать такие скрипты автоматизации, то очень легко будет переносить ваши приложения с одной конфигурации на другую. Жмем одну кнопку и копируем очереди, базы, виртуалки и часть нашей работы уже готово. Можно это делать хоть каждый раз с нуля, чтобы иметь новую полностью конфигурацию.</li>
</ul>

<h5>Пример использования: Azure Automation.</h5>
<ul>
	<li>На видео ребята показали скрипт, который постоянно запущен, он мониторит состояние сервисов, и при падении сообщает инженеру техподдержки, что на сервисе проблема. Интересный кейс по мониторингу. http://channel9.msdn.com/Events/Build/2014/3-621 последняя треть доклада.</li>
	<li>Допустим в вашей компании, аутсорсеры-аутстаферы работают на машинках в windows azure(проще контролировать работают они или нет, есть типовая среда разработки мешающая тварить-варотить.). Кроме создания типовых виртуалок при приходе нового разработчика, можно установить правило- работаем только с 9, до 18. Все остальное время машины не нужны, и могут быть выключены. Соответственно пишем скрипт, запускаем его и он постоянно запущенный мониторит текущее время, как только наступает  18.30 гасим все машины.</li>
	<li>Допустим, у вас в отделе сопровождение зафиксировали инцидент  (что-то пошло не так). Нужно устранить ошибку, но в больших компаниях нужно еще заполнить форму инцидента (что было, что затронуло, что не затронуло). Вот для сбора отчета в одну кнопку и можно использовать эту фичу. Написали скрипт, наступил инцидент, нажали на кнопку получили шаблонный отчете со статусами всех виртуалок, очередей, баз данных и тп. Можно на MAML написать, но запуск из Azure Portal на мой взгляд более логичен, чем с локальной машины.</li>
	<li>Бэкап всех баз, перед обновлением продакшена - отличная задача для автоматизации тк она долгоиграющая и запускать можно с azure portal.</li>
	<li>Обновить ключи /сертификат безопасности одной кнопкой в UI.</li>
</ul>

<b>До начала использование:</b>
Естественно нужно иметь аккаунт на Microsoft Azure.
Чтобы начать использовать эту фичу, нужно сначала подключить ее, тк она preview (Чтобы разработчик принял на себя ответственность, что это еще не релиз и что-то может работать не так).
<spoiler title="Как только вы ее подключите нужно будет создать Automation Account (Я правда не очень понял зачем так сложно, но наверное надо)"><img src="http://habrastorage.org/getpro/habr/post_images/0c7/2e9/e22/0c72e9e2209293755d8db8b39edc2d75.jpg"/>
</spoiler>
<spoiler title="Зарегистрировавшись вы увидите главную страницу. Интерфейс интуитивно понятен. "><img src="http://habrastorage.org/getpro/habr/post_images/156/195/506/156195506049b6726443d58aa4aa7dac.png"/></spoiler>
Лично я долго разбирался чем и от чего Automation отличается и зачем оно надо ,а в интерфейс за 5-7 минут все становится очевидным.

<b>Вводно-практическая часть</b>
Скрипты для Automation называются Runbook. 
<b>Runbook</b>- это скрипт с powershell workflow внутри себя.
<h5>Первые шиги</h5>
<spoiler title="Создадим наш первый Rubook.">
<img src="http://habrastorage.org/getpro/habr/post_images/665/f1d/af4/665f1daf49b15b0f7a8fa57e45a9ac52.jpg"/>
<img src="http://habrastorage.org/getpro/habr/post_images/540/c8e/705/540c8e705aab412e21b5eb648b45ed1a.jpg"/>
</spoiler>
<spoiler title="RunBook вы создаете прям в интерфейсе Windows Azure, редактируете его там же с помощью редактора Monaco."><img src="http://habrastorage.org/getpro/habr/post_images/f5c/f5d/f39/f5cf5df3924494096df0807dc4d65a86.jpg"/></spoiler>
<spoiler title="И пусть этот Runbook запрашивает при запуске значение параметра от пользователя."><img src="http://habrastorage.org/getpro/habr/post_images/070/159/50c/07015950cd4ab914529ad1c009e7d20b.jpg"/></spoiler>

<h5>Статистика </h5>
<spoiler title="Видно весь список ваших Runbooks"><img src="http://habrastorage.org/getpro/habr/post_images/c43/353/4cf/c433534cf06a352994434ce37a9cf43b.jpg"/></spoiler>

<spoiler title="Мы можем посмотреть общую статистику по всем запускам за период"><img src="http://habrastorage.org/getpro/habr/post_images/2cd/694/4c0/2cd6944c0293032de6585abbe40094af.jpg"/></spoiler>

<spoiler title="Информацию по каждому отдельному запуску- когда, кто, с какими параметрами."><img src="http://habrastorage.org/getpro/habr/post_images/be3/7db/1b3/be37db1b3fbbb711a1ad25a005421cb8.jpg"/></spoiler>

<h5>Сложнее...</h5>
Внутри себя Automation использует обычный <a href="http://msdn.microsoft.com/en-us/library/azure/jj156055.aspx">Windows Azure Module</a> для работы с api azure.
<spoiler title="Всегда можно посмотреть список команд в нем и его версию."><img src="http://habrastorage.org/getpro/habr/post_images/62c/0fd/dd6/62c0fddd67038232bcb283c0a47bbb7d.jpg"/></spoiler>
<spoiler title="Вы можете так же загрузить нужные вам powershell модули."><img src="http://habrastorage.org/getpro/habr/post_images/d52/533/0fb/d525330fb96695b41df94973aed570f4.jpg"/></spoiler>
<spoiler title="Или создать переменные среды, к которым можно обращаться из скриптов. "><img src="http://habrastorage.org/getpro/habr/post_images/f33/2d7/ede/f332d7edebf2a7de9e8f07b852557f4e.jpg"/></spoiler>


Всем удачи в изучении и использовании Automation. Лично мне фича очень понравилась своей идеей.

<h4>Ссылки:</h4>
<ul>
<li>Мы можем найти на  <a href="http://msdn.microsoft.com/en-us/library/azure/dn643627.aspx">msdn</a>  информацию для начала изучения: Как посмотреть список /создать/запустить/ посмотреть результаты выполнения  Runbook.</li>
	<li><a href="http://channel9.msdn.com/Events/Build/2014/3-621">Видео по Automation с конференции Build</a>  </li>
	<li> Простые <a href="http://msdn.microsoft.com/en-us/library/azure/dn643630.aspx">примеры</a> Runbook (реально это просто примеры работы из powershell с Microsoft Azure)</li>
	<li>Очень активно обсуждение на <a href="http://social.msdn.microsoft.com/Forums/windowsazure/en-US/home?forum=azureautomation&sort=lastpostdesc&brandIgnore=true&page=1">форуме</a>.  </li>
	<li>На конференции BUILD очень просили всех, кто разработчиков попробовать эту фичу и написать  <a href="http://feedback.azure.com/forums/246290-azure-automation">FeedBack</a> – feature requests. С апреля много воды утекло, но думаю до сих пор актуально.</li>
</ul>

Если Вы хотите помочь улучшить статью- предлогайте ваши правки через <a href="https://github.com/SychevIgor/blog_Azure/tree/master/Automation">github</a>
