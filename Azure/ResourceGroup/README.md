Весной 2014 года Microsoft анонсировала новую версию портала в стадии preview, и в ней появилась Resource Group. 

До нее группировка различных ресурсов по логическому принципу, по сути, отсутствовала. Были отдельные базы данных, отдельные сайты, отдельно storage, каждый на своей вкладке. Осознать, как и какие сущности связаны между собой, к каким приложениям относятся было занятием не всегда возможным. Как правило, решалось на уровне именования сущностей по определенному шаблону типа: ApplicationName1_web_1_Prod, ApplicationName2_db_2_Test. Но это не решение проблемы, т.к. надо было просмотреть все типы ресурсов, чтобы составить общую картину.
<b>Resource Group - это логическая группировка ресурсов. (баз данных, веб серверов и т.п.)</b>
<img src="http://habrastorage.org/files/d0f/a1f/d43/d0fa1fd4330d4909a452794ff707689e.png" alt="image"/>
Но это было уже более полугода назад. С конца осени 2014 года, когда вышла Azure SDK 2.5, <b>Resource Group стала использоваться не только для логической группировки, но на ее основе стало возможным публиковать все части приложения из visual studio в пару кликов.</b>
 
Создается json описание ресурсов в группе, добавить к этому файл трансформации (чтобы иметь возможность замены значений параметров по необходимости), и, по нажатии на кнопку публикации, мы можем раскидать все наши ресурсы по нужным местам. 
<habracut>
Есть несколько шаблонов, на основании которых создаются deploy конфигурации.
<img src="http://habrastorage.org/files/b52/7de/aa3/b527deaa30dd42f2b565a20c22e890f8.png" alt="image"/>
На мой взгляд, нужно было создать самую простую конфигурацию, вообще без Application Insight. На ее основе было бы куда проще разобраться с тем, что находится внутри. Но, к сожалению, даже в базовом шаблоне WebSite Application Insight уже добавлен.  Я его скрыл, чтобы было проще рассказывать о внутренней структуре.
<spoiler title="В итоге получится вот такой проект">
<img src="http://habrastorage.org/files/a9d/73a/12b/a9d73a12b36d4f4d8d1314076aeed07c.png" alt="image"/></spoiler>
В папке Template лежит все, что нас интересует. 

<b>Есть блок параметров, которые мы можем менять в зависимости от конфигурации.</b>
В нем не хранятся значения, за исключением параметра по умолчанию, только описание имен параметров, типы данных, ну и список возможных значений параметров перечислений.
<img src="http://habrastorage.org/files/9ff/2b5/737/9ff2b5737e1e4b21950771b77b67941a.png" alt="image"/>
В другом файле, который называется *.param.dev* находятся значения этих параметров, которые подставляются при сборке.
<img src="http://habrastorage.org/files/69a/16d/abe/69a16dabe29142d5ad22ed2b2635a940.png" alt="image"/>

<b>*dev* - это имя конфигурации, к которой относятся параметры.</b> Таких файлов с конфигурациями можно и нужно создать столько же, во сколько Resource Group мы будем проводить публикацию. 
С параметрами разобрались, теперь переходим к определению самих ресурсов.
<img src="http://habrastorage.org/files/418/452/e46/418452e46685493d821cd2c23945cfc9.png" alt="image"/>

<b>Здесь мы видим 2 ресурса. WebSite и ServerFarm, причем первый зависит от второго. После проведения трансформации вместо “parameters(‘’)” будет подставлено значение из *param* файла и файл будет простым Json документом.</b> Значение каждого конкретного поля комментировать смысла нет, они понятны тем, кто пользовался Azure ранее, а для остальных можно прочесть в <a href="http://azure.microsoft.com/blog/2014/11/26/azure-resource-manager-2-5-for-visual-studio/">статье</a>.
Я умышленно закрыл раздел resources для WebSite, чтобы было нагляднее. 
<spoiler title="Внутри ресурса - стандартные MSDEPLOY"><img src="http://habrastorage.org/files/ecd/9a9/0a2/ecd9a90a2880408a95ecb30a91c978d8.png" alt="image"/></spoiler>

Если вы возьмете шаблон с SQL Server и/или Redis, то у вас просто добавятся 2 секции примерно такого-же формата. У Redis секция вообще внимания не заслуживает, у <b>SQL Server</b>, минимальный набор параметров есть, которые нужно сконфигурировать. 
<spoiler title="Учетные данные администратора,размеры базы, collation, от куда принимать запросы  и т.п.">
<img src="http://habrastorage.org/files/b1c/517/3c3/b1c5173c375b41fc942312e4c86cde04.png" alt="image"/>
</spoiler>

<h5><b>Процесс публикации</b></h5>
У Вас есть целых 2 способа опубликовать результаты:
<ul>
<li><b>Powershell </b>
<spoiler title="Либо исполняете powershell скрипт, заботливо созданный разработчиками для автоматизации.">
<img src="http://habrastorage.org/files/519/cbf/bb6/519cbfbb610742e1873e344d4df88bab.png" alt="image"/></spoiler>
</li>
<li><b> Visual Studio Deploy</b>
<spoiler title="Либо нажимаете кнопку deploy на проекте,">
<img src="http://habrastorage.org/files/61c/dbb/6e8/61cdbb6e85a04aac8a177373c6d3b762.png" alt="image"/>
</spoiler>
<spoiler title="выбрав на основании какой подписки Azure и каких параметров проводить публикацию. ">
<img src="http://habrastorage.org/files/51f/51a/653/51f51a653a034ce39c0a905a182f697d.png" alt="image"/>
</spoiler>
<spoiler title="За процессом работы мы можем наблюдать в консоли Output ">
<img src="http://habrastorage.org/files/ea4/ba1/510/ea4ba15102e84ab69f4db7ab580d33a9.png" alt="image"/>
</spoiler>
</li>
</ul>
А сам результат увидим уже на портале.

<h5><b>Application Insight Rules</b></h5>
Тем, кто использует Application Insight, стоит обратить внимание на описание этих правил в документе, которые при деплое будут опубликованы вместе с проектом.
Большая часть правил выглядит примерно одинаково. Вот пример правила, по которому если загрузка процессора выше 90%, то отправляется нотификация. Правило состоит из 2 основных частей: 
<spoiler title="Condition - условие, которое должно выполниться, и Action- действие, которое выполнится по условию."><img src="http://habrastorage.org/files/17d/b89/1c8/17db891c8c554736b6821afce8ceb6cd.png" alt="image"/></spoiler>
В примерах почти все правила такие. Есть нотификация при увеличении длины очереди запросов к IIS, появлении множества 400* ошибок (есть вероятность, что вас пытаются сломать).

Есть еще один тип, который я бы выделил уже потому, что он структурно не похож на вышеописанные. <b>AutoScaling</b> - автомасштабирование.
Он сложнее, ведь у нас есть правило на увеличение числа машин и на уменьшение в зависимости от текущего значения нагрузки на CPU. Да и структура у него другая, нет Condition,Action блоков. 
<spoiler title="Есть MetricTrigger и ScaleAction. Не знаю, зачем было называть по другому, но наверное причина была. "><img src="http://habrastorage.org/files/abc/57c/2c2/abc57c2c286546c6a07b2ba5c6b74e1b.png" alt="image"/></spoiler>

<h5><b>Нюансы</b></h5>
Понятно, что при таком деплое мы не полностью развернем работоспособные приложения с нуля, как минимум, в базе нет данных.
Зато у нас появилась автоматизация процесса создания ресурсов, которую мы дальше можем улучшать по своему усмотрению, а наши действия стали более повторимыми “repeatable”.

<h5><b>Ссылки</b></h5>
<ul>
	<li>Анонс SDK 2.5 <a href="http://azure.microsoft.com/blog/2014/11/12/announcing-azure-sdk-2-5-for-net-and-visual-studio-2015-preview/">1</a>, <a href="http://msdn.microsoft.com/en-us/library/azure/dn873976.aspx">2</a>.</li>
	<li><a href="http://azure.microsoft.com/blog/2014/08/11/azure-resource-manager-tools-preview/">Preview версия тулзов к студии</a></li>
	<li><a href="http://azure.microsoft.com/blog/2014/11/26/azure-resource-manager-2-5-for-visual-studio/">Релизная версия тулзов к студии</a></li>
	<li><a href="http://azure.microsoft.com/en-us/documentation/articles/azure-preview-portal-using-resource-groups/">Resource groups</a></li>
</ul>

Если Вы хотите помочь улучшить статью- предлогайте ваши правки через <a href="https://github.com/SychevIgor/blog/tree/master/Azure/ResourceGroup">github</a>
